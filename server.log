
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

ðŸ”Œ Connecting to PostgreSQL: postgresql://postgres:****@localhost:5433/queenone_dev
ðŸ”“ Running in local development mode - auth bypassed
âœ… WebSocket server initialized successfully on /ws at Mon Sep 22 2025 13:18:40 GMT+0100 (British Summer Time)
   Initialization count: 1
1:18:40 PM [express] serving on port 5000
1:18:40 PM [express] WebSocket server available at ws://localhost:5000/ws
1:18:48 PM [express] GET /api/health 200 in 17ms
1:19:34 PM [express] POST /api/import/upload 200 in 6ms
1:19:34 PM [express] POST /api/import/upload 200 in 2ms
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:20:37 PM [express] POST /api/upload/initiate 200 in 33ms :: {"success":true,"sessionId":"5e523104-â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/5e523104-e178-458a-a810-c5862e463a7d/analyze
AdaptiveCSVExtractor initialized with 5 strategies: standard (priority: 100), alternative-delimiters (priority: 90), numeric-headerless (priority: 70), complex-fields (priority: 60), dirty-recovery (priority: 10)
AdaptiveCSVExtractor initialized with 5 strategies: standard (priority: 100), alternative-delimiters (priority: 90), numeric-headerless (priority: 70), complex-fields (priority: 60), dirty-recovery (priority: 10)
Adaptive field extraction completed: {
  adaptiveParsingUsed: true,
  fallbackToBasic: false,
  confidenceImprovement: 25,
  processingTime: 15,
  confidence: 95,
  strategy: 'standard'
}
Hot reload enabled for prompt templates
OpenRouter client initialized successfully
Using enhanced multi-strategy field mapping engine
Multi-strategy mapping completed: 0 mappings, confidence: 0%, strategies: , cost: $0.000000
[WORKFLOW] Analysis complete for session 5e523104-e178-458a-a810-c5862e463a7d, confidence: 0%
[WEBSOCKET] No clients connected for session 5e523104-e178-458a-a810-c5862e463a7d
[WEBSOCKET] Workflow event emitted: analysis_complete for session 5e523104-e178-458a-a810-c5862e463a7d { confidence: 0, autoAdvance: false, expectedNextStep: 1 }
[WORKFLOW] Event emitted: analysis_complete for session 5e523104-e178-458a-a810-c5862e463a7d
[WORKFLOW] Requesting user mapping intervention (confidence: 0%)
[WEBSOCKET] No clients connected for session 5e523104-e178-458a-a810-c5862e463a7d
[WEBSOCKET] Workflow event emitted: mapping_suggestions for session 5e523104-e178-458a-a810-c5862e463a7d { confidence: 0, autoAdvance: false, expectedNextStep: undefined }
[WORKFLOW] Event emitted: mapping_suggestions for session 5e523104-e178-458a-a810-c5862e463a7d
1:21:07 PM [express] POST /api/upload/5e523104-e178-458a-a810-c5862e463a7d/analyze 200 in 10163ms ::â€¦
1:21:42 PM [express] GET /api/upload/status/5e523104-e178-458a-a810-c5862e463a7d 200 in 12ms :: {"suâ€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:22:26 PM [express] POST /api/upload/initiate 200 in 9ms :: {"success":true,"sessionId":"d86ff1b8-eâ€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730/analyze
Adaptive field extraction completed: {
  adaptiveParsingUsed: true,
  fallbackToBasic: false,
  confidenceImprovement: 25,
  processingTime: 1,
  confidence: 95,
  strategy: 'standard'
}
Using enhanced multi-strategy field mapping engine
Multi-strategy mapping completed: 3 mappings, confidence: 88%, strategies: exact, fuzzy, semantic, historical, llm, cost: $0.000285
[WORKFLOW] Analysis complete for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730, confidence: 87.67%
[WEBSOCKET] No clients connected for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] Workflow event emitted: analysis_complete for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730 { confidence: 87.67, autoAdvance: true, expectedNextStep: 1 }
[WORKFLOW] Event emitted: analysis_complete for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WORKFLOW] Auto-advancing to preview generation (confidence: 87.67%)
[WORKFLOW] Starting auto preview generation for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] No clients connected for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] Workflow event emitted: preview_generation_started for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730 { confidence: undefined, autoAdvance: true, expectedNextStep: 1 }
[WORKFLOW] Event emitted: preview_generation_started for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
Successfully parsed CSV with standard strategy (confidence: 95%)
Successfully retrieved cached file data: 4 records
[ENHANCED IMPORT] Internal preview generated for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730: 4/4 valid records
[WEBSOCKET] No clients connected for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] Workflow event emitted: preview_ready for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730 { confidence: undefined, autoAdvance: true, expectedNextStep: 2 }
[WORKFLOW] Event emitted: preview_ready for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
1:22:40 PM [express] POST /api/upload/d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730/analyze 200 in 7954ms :: â€¦
[WORKFLOW] Advancing to approval step for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] No clients connected for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[WEBSOCKET] Workflow event emitted: approval_required for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730 { confidence: undefined, autoAdvance: true, expectedNextStep: 2 }
[WORKFLOW] Event emitted: approval_required for session d86ff1b8-e0e5-4fcd-ac24-0c4d75ced730
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:22:47 PM [express] POST /api/upload/initiate 200 in 3ms :: {"success":true,"sessionId":"a1c07245-bâ€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/a1c07245-b7f0-4605-a028-628b7335f28a/analyze
Adaptive field extraction completed: {
  adaptiveParsingUsed: true,
  fallbackToBasic: false,
  confidenceImprovement: 25,
  processingTime: 0,
  confidence: 95,
  strategy: 'standard'
}
Using enhanced multi-strategy field mapping engine
Multi-strategy mapping completed: 3 mappings, confidence: 89%, strategies: exact, fuzzy, semantic, historical, llm, cost: $0.000295
[WORKFLOW] Analysis complete for session a1c07245-b7f0-4605-a028-628b7335f28a, confidence: 89%
[WEBSOCKET] No clients connected for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] Workflow event emitted: analysis_complete for session a1c07245-b7f0-4605-a028-628b7335f28a { confidence: 89, autoAdvance: true, expectedNextStep: 1 }
[WORKFLOW] Event emitted: analysis_complete for session a1c07245-b7f0-4605-a028-628b7335f28a
[WORKFLOW] Auto-advancing to preview generation (confidence: 89%)
[WORKFLOW] Starting auto preview generation for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] No clients connected for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] Workflow event emitted: preview_generation_started for session a1c07245-b7f0-4605-a028-628b7335f28a { confidence: undefined, autoAdvance: true, expectedNextStep: 1 }
[WORKFLOW] Event emitted: preview_generation_started for session a1c07245-b7f0-4605-a028-628b7335f28a
Successfully parsed CSV with standard strategy (confidence: 95%)
Successfully retrieved cached file data: 3 records
[ENHANCED IMPORT] Internal preview generated for session a1c07245-b7f0-4605-a028-628b7335f28a: 3/3 valid records
[WEBSOCKET] No clients connected for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] Workflow event emitted: preview_ready for session a1c07245-b7f0-4605-a028-628b7335f28a { confidence: undefined, autoAdvance: true, expectedNextStep: 2 }
[WORKFLOW] Event emitted: preview_ready for session a1c07245-b7f0-4605-a028-628b7335f28a
1:23:01 PM [express] POST /api/upload/a1c07245-b7f0-4605-a028-628b7335f28a/analyze 200 in 7023ms :: â€¦
[WORKFLOW] Advancing to approval step for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] No clients connected for session a1c07245-b7f0-4605-a028-628b7335f28a
[WEBSOCKET] Workflow event emitted: approval_required for session a1c07245-b7f0-4605-a028-628b7335f28a { confidence: undefined, autoAdvance: true, expectedNextStep: 2 }
[WORKFLOW] Event emitted: approval_required for session a1c07245-b7f0-4605-a028-628b7335f28a
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:23:29 PM [express] POST /api/upload/initiate 200 in 7ms :: {"success":true,"sessionId":"34e378aa-4â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/34e378aa-4bc5-4c44-9519-adbb9eba1605/analyze
File analysis error: Error: Field extraction failed: Invalid JSON format: Unexpected token 'T', "This is no"... is not valid JSON
    at EnhancedImportService.analyzeFile (/Users/cos/Documents/Projects/QueenOne/ProductPrototype/server/enhanced-import-service.ts:250:15)
    at async <anonymous> (/Users/cos/Documents/Projects/QueenOne/ProductPrototype/server/routes.ts:1291:7)
1:23:40 PM [express] POST /api/upload/34e378aa-4bc5-4c44-9519-adbb9eba1605/analyze 500 in 16ms :: {"â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/34e378aa-4bc5-4c44-9519-adbb9eba1605/analyze
File analysis error: Error: Field extraction failed: Invalid JSON format: Unexpected token 'T', "This is no"... is not valid JSON
    at EnhancedImportService.analyzeFile (/Users/cos/Documents/Projects/QueenOne/ProductPrototype/server/enhanced-import-service.ts:250:15)
    at async <anonymous> (/Users/cos/Documents/Projects/QueenOne/ProductPrototype/server/routes.ts:1291:7)
1:31:41 PM [express] POST /api/upload/34e378aa-4bc5-4c44-9519-adbb9eba1605/analyze 500 in 31ms :: {"â€¦
1:31:49 PM [express] GET /api/upload/status/invalid-session-id 404 in 4ms :: {"error":"Session not fâ€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:38:18 PM [express] POST /api/upload/initiate 200 in 17ms :: {"success":true,"sessionId":"efbe63cf-â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:38:18 PM [express] POST /api/upload/initiate 200 in 2ms :: {"success":true,"sessionId":"79b0fcb5-2â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:38:18 PM [express] POST /api/upload/initiate 200 in 3ms :: {"success":true,"sessionId":"d6f56159-1â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:38:18 PM [express] POST /api/upload/initiate 200 in 18ms :: {"success":true,"sessionId":"991b01fe-â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:38:18 PM [express] POST /api/upload/initiate 200 in 1ms :: {"success":true,"sessionId":"f7be9f8e-5â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/initiate
1:39:02 PM [express] POST /api/upload/initiate 200 in 15ms :: {"success":true,"sessionId":"5664a0d1-â€¦
[CSRF] Skipping CSRF protection in development for POST /api/upload/5664a0d1-6afb-4a4d-a168-7c02d6c69c9c/analyze
Adaptive field extraction completed: {
  adaptiveParsingUsed: true,
  fallbackToBasic: false,
  confidenceImprovement: 25,
  processingTime: 2,
  confidence: 95,
  strategy: 'standard'
}
Using enhanced multi-strategy field mapping engine
Multi-strategy mapping completed: 0 mappings, confidence: 0%, strategies: , cost: $0.000000
[WORKFLOW] Analysis complete for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c, confidence: 0%
[WEBSOCKET] No clients connected for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c
[WEBSOCKET] Workflow event emitted: analysis_complete for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c { confidence: 0, autoAdvance: false, expectedNextStep: 1 }
[WORKFLOW] Event emitted: analysis_complete for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c
[WORKFLOW] Requesting user mapping intervention (confidence: 0%)
[WEBSOCKET] No clients connected for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c
[WEBSOCKET] Workflow event emitted: mapping_suggestions for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c { confidence: 0, autoAdvance: false, expectedNextStep: undefined }
[WORKFLOW] Event emitted: mapping_suggestions for session 5664a0d1-6afb-4a4d-a168-7c02d6c69c9c
1:39:12 PM [express] POST /api/upload/5664a0d1-6afb-4a4d-a168-7c02d6c69c9c/analyze 200 in 10024ms ::â€¦
